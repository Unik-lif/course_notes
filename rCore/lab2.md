## 第一章：基本执行环境
### 引言：
批处理的诞生背景：管理无需或者仅需少量用户交互就可运行的程序。因为计算机运行是很珍贵的，就当是煮火锅要花很多电费吧，我要积攒一部分好菜再去涮火锅，这样才比较合适。

本章的主线任务：

用户态的分割 -> 系统调用的实现 -> 轮转启动运行的操作系统 -> 资源调度/trap上下文的保存与恢复。
### 特权级机制：
其实就是画饼啊哈哈，比如，一个合理的操作系统应该是什么样的？

rCore作者们似乎是认为，特权级的出现源于多任务的调度使得作为内核的部件的安全性受到了compromise。

因此，一个比较贴心的应用程序应该做到两方面的限制：
1. 不能访问任意的地址空间
2. 不能执行某些可能破坏计算机系统的指令

用户采用传统的函数调用方式，如`call`与`ret`将会直接绕过硬件的特权级保护检查。所以可以设计新的机器指令，分别是`ecall`与`eret`。

#### RISCV特权级架构
RISCV中定义了四种特权级。

| 级别 | 编码 | 名称 |
|  ----  | ----  | --- |
|  0 | 00 | 用户模式 user |
| 1 | 01 | 监督模式 supervisor|
| 2 | 10 | 虚拟监督模式 hypervisor|
| 3 | 11| 机器模式 machine|

rCore的操作系统会使用M/S/U共三个特权级，之间分别利用SBI和ABI进行交互。

RISCV存在部分特权指令，以S模式为例，一般有两类：
1. 本身属于高特权级的指令
2. 访问了高特权级才能访问的内存或者寄存器

### 应用程序实现
实现应用程序的出发点：
1. 应用程序的内存布局
2. 应用程序发出的系统调用如何处理
